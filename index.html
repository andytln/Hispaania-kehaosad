<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8" />
  <title>Hispaania keel ‚Äì S√µnavara ja test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- PWA & iOS asjad -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ES √µppe√§pp" />
  <meta name="theme-color" content="#ffffff" />

  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="manifest" href="manifest.json" />

  <style>
    /* Hispaania lipu taust: punane - kollane - punane horisontaalsed ribad */
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background: linear-gradient(
        to bottom,
        #A40000 0%,   #A40000 22%,
        #FFD100 22%,  #FFD100 78%,
        #A40000 78%,  #A40000 100%
      );
      font-family: Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .app {
      background: rgba(255, 255, 255, 0.96);
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      padding: 20px 24px;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
      max-height: 100%;
      overflow-y: auto; /* sisu kerib, raam j√§√§b paigale */
    }

    h1, h2, h3, h4 {
      text-align: center;
    }
    #main-nav {
      text-align: center;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 16px;
      margin: 6px 4px;
      border-radius: 8px;
      border: 1px solid #333;
      background-color: #f0f0f0;
      cursor: pointer;
    }
    button:hover {
      background-color: #e0e0e0;
    }
    #main-nav button {
      min-width: 140px;
    }
    .vocab-block {
      margin-top: 24px;
    }
    .vocab-block h3 {
      margin-bottom: 8px;
    }
    .vocab-block h4 {
      margin-top: 12px;
      margin-bottom: 4px;
      text-align: left;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    /* Testi osa stiilid */
    #quiz-area {
      margin-top: 20px;
    }
    #estonian-word {
      font-size: 1.4em;
      font-weight: bold;
      margin: 16px 0;
      text-align: center;
    }
    #answer-input {
      width: 100%;
      padding: 8px;
      font-size: 1.1em;
      margin-top: 4px;
      box-sizing: border-box;
    }
    #feedback {
      margin-top: 12px;
      font-weight: bold;
    }
    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    #top-bar-title {
      flex: 1;
      text-align: center;
      font-weight: bold;
    }
    .correct-row {
      background-color: #d4edda; /* √µige ‚Äì hele roheline */
    }
    .wrong-row {
      background-color: #f8d7da; /* vale ‚Äì hele punane */
    }
    #last-result {
      margin-top: 20px;
    }
    .list-note {
      font-size: 14px;
      color: #555;
      margin-top: 6px;
    }

    /* S√µnavara valiku nuppude rida j√§√§b kerimisel n√§htavale */
    #vocab-buttons {
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(255, 255, 255, 0.96);
      padding-bottom: 8px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Hispaania keel ‚Äì s√µnavara ja test</h1>

    <!-- √úLEMINE VALIK: S√µnavara vs Test -->
    <div id="main-nav">
      <button id="btn-vocab" type="button">S√µnavara</button>
      <button id="btn-quiz" type="button">Testi oskuseid</button>
    </div>

    <!-- S√ïNAVARA OSA -->
    <div id="vocab-area" style="display:none;">
      <h2>S√µnavara</h2>

      <div id="vocab-buttons" style="text-align:center;">
        <button id="vocab-numbers-btn">Numbrid</button>
        <button id="vocab-days-btn">P√§evad, kuud ja suunad</button>
        <button id="vocab-body-btn">Kehaosad</button>
        <button id="vocab-back-btn">Tagasi</button>
      </div>
      <div id="vocab-note" class="list-note">
        Vali √ºks kategooria, et n√§ha selle s√µnu, mida hetkel saab kontrollida.
      </div>
      <div id="vocab-list"></div>
    </div>

    <!-- TESTI OSA -->
    <div id="quiz-section" style="display:none;">

      <!-- Blokivalik testimiseks -->
      <div id="mode-select">
        <h2>Testi oskuseid</h2>
        <p style="text-align:center;">Vali blokk, mida harjutada:</p>
        <div style="text-align:center;">
          <button id="mode-body">Kehaosad</button>
          <button id="mode-numbers">Numbrid</button>
          <button id="mode-days">P√§evad ja suunad</button>
        </div>
      </div>

      <!-- P√§ris testimine -->
      <div id="quiz-area" style="display:none;">
        <div id="top-bar">
          <button id="restart-btn">Kokkuv√µte</button>
          <div id="top-bar-title"><span id="mode-title"></span></div>
          <button id="cancel-btn">Katkesta</button>
        </div>

        <p id="instructions"></p>

        <div id="estonian-word">Vajuta ‚ÄûJ√§rgmine‚Äù</div>

        <label for="answer-input">
          Sinu vastus hispaania keeles:
        </label>
        <input type="text" id="answer-input" autocomplete="off" />

        <div>
          <button id="voice-btn" type="button">üé§ √útle vastus</button>
          <span id="speech-status"></span>
        </div>

        <br />

        <button id="check-btn">Kontrolli</button>
        <button id="next-btn">J√§rgmine</button>

        <div id="feedback"></div>

        <div id="last-result"></div>
      </div>

      <!-- Testi kokkuv√µte -->
      <div id="summary"></div>
    </div>
  </div>

  <script>
    // ---------- HISP. NUMBRID ABIFUNKTSIOON ----------
    function spanishNumber(n) {
      n = Number(n);
      if (!Number.isInteger(n) || n <= 0 || n > 9999) return String(n);

      const units = ["", "uno", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"]; 
      const teens = { 10: "diez", 11: "once", 12: "doce", 13: "trece", 14: "catorce", 15: "quince" };
      const tensWords = {
        2: "veinte",
        3: "treinta",
        4: "cuarenta",
        5: "cincuenta",
        6: "sesenta",
        7: "setenta",
        8: "ochenta",
        9: "noventa"
      };
      const hundredsWords = {
        1: "ciento",
        2: "doscientos",
        3: "trescientos",
        4: "cuatrocientos",
        5: "quinientos",
        6: "seiscientos",
        7: "setecientos",
        8: "ochocientos",
        9: "novecientos"
      };

      if (n <= 9) return units[n];
      if (n >= 10 && n <= 15) return teens[n];
      if (n < 20) return "dieci" + units[n - 10];

      if (n === 20) return "veinte";
      if (n > 20 && n < 30) return "veinti" + units[n - 20];

      if (n < 100) {
        const t = Math.floor(n / 10);
        const u = n % 10;
        if (u === 0) return tensWords[t];
        return tensWords[t] + (t === 2 ? "" : " y ") + units[u];
      }

      if (n === 100) return "cien";
      if (n < 200) return "ciento " + spanishNumber(n - 100);

      if (n < 1000) {
        const h = Math.floor(n / 100);
        const r = n % 100;
        if (r === 0) return hundredsWords[h];
        return hundredsWords[h] + " " + spanishNumber(r);
      }

      if (n === 1000) return "mil";
      if (n < 2000) return "mil " + spanishNumber(n - 1000);

      const thousands = Math.floor(n / 1000);
      const rem = n % 1000;
      const thousandsPart = spanishNumber(thousands) + " mil";
      if (rem === 0) return thousandsPart;
      return thousandsPart + " " + spanishNumber(rem);
    }

    // ---------- S√ïNAVARA ANDMED (VAADATAKS, MITTE TESTIKS) ----------

    const vocabWeekdays = [
      { et: "esmasp√§ev", es: "lunes" },
      { et: "teisip√§ev", es: "martes" },
      { et: "kolmap√§ev", es: "mi√©rcoles" },
      { et: "neljap√§ev", es: "jueves" },
      { et: "reede", es: "viernes" },
      { et: "laup√§ev", es: "s√°bado" },
      { et: "p√ºhap√§ev", es: "domingo" }
    ];

    const vocabMonths = [
      { et: "jaanuar", es: "enero" },
      { et: "veebruar", es: "febrero" },
      { et: "m√§rts", es: "marzo" },
      { et: "aprill", es: "abril" },
      { et: "mai", es: "mayo" },
      { et: "juuni", es: "junio" },
      { et: "juuli", es: "julio" },
      { et: "august", es: "agosto" },
      { et: "september", es: "septiembre" },
      { et: "oktoober", es: "octubre" },
      { et: "november", es: "noviembre" },
      { et: "detsember", es: "diciembre" }
    ];

    const vocabDirections = [
      { et: "p√µhi", es: "norte" },
      { et: "l√µuna", es: "sur" },
      { et: "ida", es: "este" },
      { et: "l√§√§s", es: "oeste" },
      { et: "√ºles", es: "arriba" },
      { et: "alla", es: "abajo" },
      { et: "vasakule", es: "a la izquierda" },
      { et: "paremale", es: "a la derecha" },
      { et: "edasi", es: "adelante" },
      { et: "tagasi", es: "atr√°s" }
    ];

    const vocabBody = [
      { et: "pea", es: "la cabeza" },
      { et: "juuksed", es: "el pelo" },
      { et: "otsmik", es: "la frente" },
      { et: "kulm", es: "la ceja" },
      { et: "kulmud", es: "las cejas" },
      { et: "ripsmed", es: "las pesta√±as" },
      { et: "silm", es: "el ojo" },
      { et: "silmad", es: "los ojos" },
      { et: "nina", es: "la nariz" },
      { et: "p√µsk", es: "la mejilla" },
      { et: "p√µsed", es: "las mejillas" },
      { et: "suu", es: "la boca" },
      { et: "huuled", es: "los labios" },
      { et: "hammas", es: "el diente" },
      { et: "hambad", es: "los dientes" },
      { et: "keel", es: "la lengua" },
      { et: "l√µug", es: "la barbilla" },
      { et: "kael", es: "el cuello" },
      { et: "√µlg", es: "el hombro" },
      { et: "√µlad", es: "los hombros" },
      { et: "rindkere", es: "el pecho" },
      { et: "selg", es: "la espalda" },
      { et: "k√µht", es: "la barriga" },
      { et: "meeste suguelund", es: "el pene" },
      { et: "naiste suguelund", es: "la vagina" },
      { et: "puus", es: "la cadera" },
      { et: "k√§si (√µlast randmeni)", es: "el brazo" },
      { et: "k√§si (randmest allpool)", es: "la mano" },
      { et: "s√µrm", es: "el dedo" },
      { et: "s√µrmed", es: "los dedos" },
      { et: "tagumik", es: "el culo" },
      { et: "jalg", es: "la pierna" },
      { et: "p√µlv", es: "la rodilla" },
      { et: "p√∂id (jalg)", es: "el pie" },
      { et: "varvas", es: "el dedo del pie" }
    ];

    // ---------- TESTI ANDMED (PALJU VARIANTE + SL√ÑNG) ----------

    const bodyWords = [
      { et: "pea", es: ["cabeza", "la cabeza", "cabecita", "el coco", "testa"] },
      { et: "silm", es: ["ojo", "el ojo", "ojito", "ojitos"] },
      { et: "nina", es: ["nariz", "la nariz", "naricita", "napia"] },
      { et: "suu", es: ["boca", "la boca", "boquita", "hocico", "jeta", "la jeta"] },
      { et: "hammas", es: ["diente", "el diente", "dientecito", "muela", "la muela", "pi√±o"] },
      { et: "keel", es: ["lengua", "la lengua", "leng√ºita", "lenguita"] },
      { et: "k√µrv", es: ["oreja", "la oreja", "orejita", "orejitas"] },
      { et: "kael", es: ["cuello", "el cuello", "cuellito", "pescuezo", "el pescuezo"] },
      { et: "√µlg", es: ["hombro", "el hombro", "hombrito"] },
      { et: "k√§si (randmest allpool)", es: ["mano", "la mano", "manita", "manitas", "garra"] },
      { et: "s√µrm", es: ["dedo", "el dedo", "dedito", "deditos"] },
      { et: "rind", es: ["pecho", "el pecho", "pechito", "pechitos", "teta", "tetas", "bubis"] },
      { et: "selg", es: ["espalda", "la espalda", "espaldita"] },
      {
        et: "k√µht",
        es: [
          "barriga", "la barriga",
          "estomago", "est√≥mago",
          "el estomago", "el est√≥mago",
          "panza", "la panza", "pancita", "tripita", "barriguita", "vientre"
        ]
      },
      { et: "jalg", es: ["pierna", "la pierna", "piernita", "piernitas"] },
      { et: "p√µlv", es: ["rodilla", "la rodilla", "rodillita"] },
      {
        et: "varvas",
        es: [
          "dedo del pie", "el dedo del pie",
          "deditos del pie", "deditos"
        ]
      },
      {
        et: "tagumik",
        es: [
          "culo", "el culo",
          "trasero", "el trasero",
          "pompis", "pompas",
          "nalgas", "las nalgas",
          "traserito", "retaguardia"
        ]
      },
      { et: "naeratus", es: ["sonrisa", "la sonrisa", "sonrisita"] },
      { et: "ripsmed", es: ["pesta√±as", "las pesta√±as", "pesta√±itas"] },
      { et: "huuled", es: ["labios", "los labios", "labiecitos", "morros", "los morros"] },
      { et: "p√µsk", es: ["mejilla", "la mejilla", "cachete", "el cachete", "cachetito"] },
      { et: "p√µsed", es: ["mejillas", "las mejillas", "cachetes", "los cachetes", "cachetitos"] },
      { et: "kulm", es: ["ceja", "la ceja", "cejita"] },
      { et: "kulmud", es: ["cejas", "las cejas", "cejitas"] },
      {
        et: "meeste suguelund",
        es: [
          "pene", "el pene",
          "pito",
          "verga",
          "mi cosita",
          "pajarito",
          "polla",
          "mi miembro",
          "pirul√≠n"
        ]
      },
      {
        et: "naiste suguelund",
        es: [
          "vagina", "la vagina",
          "chocho",
          "chucha",
          "pucha",
          "cosita",
          "chuchita",
          "concha",
          "parte √≠ntima", "parte intima"
        ]
      }
    ];

    const daysAndDirs = [
      { et: "esmasp√§ev", es: ["lunes", "el lunes"] },
      { et: "teisip√§ev", es: ["martes", "el martes"] },
      {
        et: "kolmap√§ev",
        es: ["mi√©rcoles", "miercoles", "el mi√©rcoles", "el miercoles"]
      },
      { et: "neljap√§ev", es: ["jueves", "el jueves"] },
      { et: "reede", es: ["viernes", "el viernes"] },
      {
        et: "laup√§ev",
        es: ["s√°bado", "sabado", "el s√°bado", "el sabado"]
      },
      { et: "p√ºhap√§ev", es: ["domingo", "el domingo"] },

      { et: "p√µhi", es: ["norte", "el norte"] },
      { et: "l√µuna", es: ["sur", "el sur"] },
      { et: "ida", es: ["este", "el este"] },
      { et: "l√§√§s", es: ["oeste", "el oeste"] },

      { et: "√ºles", es: ["arriba", "hacia arriba", "pa arriba", "para arriba"] },
      { et: "alla", es: ["abajo", "hacia abajo", "pa abajo", "para abajo"] },
      { et: "vasakule", es: ["a la izquierda", "izquierda"] },
      { et: "paremale", es: ["a la derecha", "derecha"] },
      {
        et: "edasi",
        es: ["adelante", "hacia adelante", "recto", "sigue recto", "todo recto"]
      },
      {
        et: "tagasi",
        es: ["atr√°s", "atras", "hacia atr√°s", "hacia atras", "para atr√°s", "pa atr√°s"]
      }
    ];

    function buildNumberWords() {
      const pool = [];
      for (let i = 1; i <= 100; i++) pool.push(i);
      for (let i = 1; i <= 9; i++) pool.push(i * 100);
      for (let i = 1; i <= 9; i++) pool.push(i * 1000);

      const shuffled = pool.sort(function () { return Math.random() - 0.5; });
      const selected = shuffled.slice(0, 10);

      return selected.map(function (n) {
        const word = spanishNumber(n);
        const forms = [word, String(n)];
        if (n === 1) {
          forms.push("un", "una");
        }
        if (n === 100) {
          forms.push("ciento");
        }
        return {
          et: String(n),
          es: forms
        };
      });
    }

    // ---------- TESTI MUUTUJAD ----------

    let currentWords = [];
    let currentWord = null;
    let usedIndices = [];
    let results = [];
    let currentMode = null;
    let lastResult = null;
    const MAX_QUESTIONS = 15;
    let questionLimit = 0;
    let recognition = null;
    let speechSupported = false;

    // ---------- ABI FUNKTSIOONID ----------

    function normalize(str) {
      return String(str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function speak(text, lang) {
      if (!("speechSynthesis" in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      window.speechSynthesis.speak(utterance);
    }

    function initSpeechRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return;

      recognition = new SpeechRecognition();
      recognition.lang = "es-ES";
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        if (!event.results || !event.results[0] || !event.results[0][0]) return;
        const transcript = event.results[0][0].transcript;
        answerInput.value = transcript;
        document.getElementById("speech-status").textContent = `Kuuldud: "${transcript}"`;
      };

      recognition.onerror = function (event) {
        document.getElementById("speech-status").textContent =
          "H√§√§letuvastus eba√µnnestus: " + event.error;
      };

      recognition.onend = function () {
        voiceBtn.disabled = false;
      };

      speechSupported = true;
    }

    function startVoiceInput() {
      if (!speechSupported || !recognition) return;
      document.getElementById("speech-status").textContent = "Kuulan ...";
      voiceBtn.disabled = true;
      recognition.start();
    }

    function showModeSelect() {
      document.getElementById("mode-select").style.display = "block";
      document.getElementById("quiz-area").style.display = "none";
    }

    function renderLastResult() {
      const div = document.getElementById("last-result");
      if (!lastResult) {
        div.innerHTML = "";
        return;
      }
      const rowClass = lastResult.ok ? "correct-row" : "wrong-row";
      let html = "<h3>Eelmine k√ºsimus</h3>";
      html += '<table><tr><th>Eesti</th><th>Sinu vastus</th><th>√ïige(d)</th></tr>';
      html += `<tr class="${rowClass}">
                 <td>${lastResult.et}</td>
                 <td>${lastResult.user}</td>
                 <td>${lastResult.correct}</td>
               </tr>`;
      html += "</table>";
      div.innerHTML = html;
    }

    function startMode(mode) {
      currentMode = mode;
      usedIndices = [];
      results = [];
      lastResult = null;
      currentWord = null;
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer-input").value = "";
      document.getElementById("summary").innerHTML = "";
      renderLastResult();
      questionLimit = 0;

      document.getElementById("speech-status").textContent = speechSupported
        ? "Saad kirjutamise asemel ka h√§√§lega vastata."
        : "H√§√§letuvastus ei ole selles brauseris toetatud.";
      voiceBtn.disabled = !speechSupported;

      if (mode === "body") {
        currentWords = bodyWords.slice();
        document.getElementById("mode-title").textContent = "Kehaosad";
        document.getElementById("instructions").textContent =
          "Kuvatakse kehaosa eesti keeles. Kirjuta hispaaniakeelne vastus (v√µid kasutada ka h√§√§lsisestust).";
      } else if (mode === "numbers") {
        currentWords = buildNumberWords();
        document.getElementById("mode-title").textContent = "Numbrid";
        document.getElementById("instructions").textContent =
          "K√ºsitakse juhuslikke numbreid (1‚Äì100, sajad, tuhanded). V√µid vastata hispaania s√µnaga v√µi lihtsalt numbriga (nt 1 / uno / un / una).";
      } else if (mode === "days") {
        currentWords = daysAndDirs.slice();
        document.getElementById("mode-title").textContent = "P√§evad ja suunad";
        document.getElementById("instructions").textContent =
          "K√ºsitakse n√§dalap√§evi, ilmakaari ja suundi (√ºles, alla, vasakule, paremale, edasi, tagasi). V√µid kasutada ka k√µnekeelseid variante (nt pa arriba).";
      }

      questionLimit = Math.min(MAX_QUESTIONS, currentWords.length);

      document.getElementById("mode-select").style.display = "none";
      document.getElementById("quiz-area").style.display = "block";

      pickNewWord();
    }

    function pickNewWord() {
      if (!currentWords.length) return;

      if (usedIndices.length >= questionLimit ||
          usedIndices.length === currentWords.length) {
        showSummary();
        return;
      }

      let index;
      do {
        index = Math.floor(Math.random() * currentWords.length);
      } while (usedIndices.includes(index));

      usedIndices.push(index);
      currentWord = currentWords[index];

      document.getElementById("estonian-word").textContent = currentWord.et;
      document.getElementById("answer-input").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer-input").focus();
      document.getElementById("speech-status").textContent = speechSupported
        ? "Saad vajutada ‚Äû√útle vastus‚Äù ja vastata h√§√§lega."
        : "H√§√§letuvastus ei ole selles brauseris toetatud.";
    }

    function checkAnswer() {
      if (!currentWord) return;

      const inputRaw = document.getElementById("answer-input").value;
      const input = normalize(inputRaw);
      if (!input) {
        document.getElementById("feedback").textContent =
          "Kirjuta palun vastus enne kontrollimist.";
        return;
      }

      const correctNormalized = currentWord.es.map(normalize);
      const isCorrect = correctNormalized.includes(input);
      const feedback = document.getElementById("feedback");
      const correctText = currentWord.es.join(", ");

      const row = {
        et: currentWord.et,
        user: inputRaw,
        correct: correctText,
        ok: isCorrect
      };

      results.push(row);
      lastResult = row;
      renderLastResult();

      if (isCorrect) {
        feedback.textContent = "√ïIGE! ‚úÖ ‚Äì " + correctText;
      } else {
        feedback.textContent = "‚ùå Vale. √ïige(d): " + correctText;
      }

      speak(currentWord.es[0], "es-ES");

      if (results.length >= questionLimit) {
        feedback.textContent += " Maksimum 15 k√ºsimust on t√§is ‚Äì kuvan kokkuv√µtte.";
        setTimeout(showSummary, 500);
      }
    }

    function renderSummary() {
      const summaryDiv = document.getElementById("summary");
      summaryDiv.innerHTML = "";

      if (!results.length) {
        summaryDiv.innerHTML = "<h2>Kokkuv√µte</h2><p>√úhtegi vastust ei j√µudnud anda.</p>";
        return;
      }

      const correctCount = results.filter(r => r.ok).length;
      let html = "<h2>Kokkuv√µte</h2>" +
        "<p>√ïigeid vastuseid: " + correctCount + " / " + results.length + "</p>";

      html += "<table><tr><th>Eesti s√µna / number</th><th>Sinu vastus</th><th>√ïige(d)</th></tr>";

      results.forEach(function (row) {
        const rowClass = row.ok ? "correct-row" : "wrong-row";
        html += '<tr class="' + rowClass + '">';
        html += "<td>" + row.et + "</td>";
        html += "<td>" + row.user + "</td>";
        html += "<td>" + row.correct + "</td>";
        html += "</tr>";
      });

      html += "</table>";
      summaryDiv.innerHTML = html;
    }

    function showSummary() {
      renderSummary();
      showModeSelect();
    }

    // ---------- PEAVAATE / NAV FUNKTSIOONID ----------

    const btnVocab = document.getElementById("btn-vocab");
    const btnQuiz = document.getElementById("btn-quiz");
    const vocabArea = document.getElementById("vocab-area");
    const quizSection = document.getElementById("quiz-section");

    function showInitial() {
      vocabArea.style.display = "none";
      quizSection.style.display = "none";
    }

    function showVocab() {
      vocabArea.style.display = "block";
      quizSection.style.display = "none";
      document.getElementById("vocab-note").textContent =
        "Vali √ºks kategooria, et n√§ha selle s√µnu, mida hetkel saab kontrollida.";
      document.getElementById("vocab-list").innerHTML = "";
    }

    function showQuiz() {
      vocabArea.style.display = "none";
      quizSection.style.display = "block";
      showModeSelect();
    }

    btnVocab.onclick = showVocab;
    btnQuiz.onclick = showQuiz;

    function goBackFromVocab() {
      showInitial();
      // kerime ka risti √ºles, et iPhone'il ei j√§√§ks kuhugi keskele kinni
      document.querySelector('.app').scrollTop = 0;
      window.scrollTo(0, 0);
    }

    // ---------- S√ïNAVARA BLOKKIDE NUPUD ----------

    const vocabNumbersBtn = document.getElementById("vocab-numbers-btn");
    const vocabDaysBtn = document.getElementById("vocab-days-btn");
    const vocabBodyBtn = document.getElementById("vocab-body-btn");
    const vocabBackBtn = document.getElementById("vocab-back-btn");

    function showVocabCategory(category) {
      const listDiv = document.getElementById("vocab-list");
      let html = "";

      if (category === "numbers") {
        html += "<div class='vocab-block'>";
        html += "<h3>Numbrid</h3>";
        html += "<p style='text-align:center;'>1‚Äì20, seej√§rel 20, 25, 30, 35, 40, k√ºmnelised kuni 100 ning sajad kuni 1000.</p>";
        html += "<table><thead><tr><th>Eesti (number)</th><th>Hispaania (s√µnana)</th></tr></thead><tbody>";

        const order = [];
        const added = new Set();
        function addNumber(n) {
          if (!added.has(n)) {
            added.add(n);
            order.push(n);
          }
        }
        for (let i = 1; i <= 20; i++) addNumber(i);
        [20, 25, 30, 35, 40].forEach(addNumber);
        for (let i = 10; i <= 100; i += 10) addNumber(i);
        for (let i = 100; i <= 1000; i += 100) addNumber(i);

        order.forEach(function (n) {
          html += "<tr><td>" + n + "</td><td>" + spanishNumber(n) + "</td></tr>";
        });

        html += "</tbody></table>";
        html += "<div style='text-align:center; margin-top:12px;'>";
        html += "<button type='button' onclick='goBackFromVocab()'>Tagasi</button>";
        html += "</div>";
        html += "</div>";
      } else if (category === "days") {
        html += "<div class='vocab-block'>";
        html += "<h3>P√§evad, kuud ja suunad</h3>";

        html += "<h4>N√§dalap√§evad (E‚ÄìP)</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Hispaania</th></tr></thead><tbody>";
        vocabWeekdays.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.es + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "<h4>Kuud (Jaanuar ‚Äì Detsember)</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Hispaania</th></tr></thead><tbody>";
        vocabMonths.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.es + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "<h4>Suunad ja liikumine</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Hispaania</th></tr></thead><tbody>";
        vocabDirections.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.es + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "<div style='text-align:center; margin-top:12px;'>";
        html += "<button type='button' onclick='goBackFromVocab()'>Tagasi</button>";
        html += "</div>";

        html += "</div>";
      } else if (category === "body") {
        html += "<div class='vocab-block'>";
        html += "<h3>Kehaosad (juustest varvasteni)</h3>";
        html += "<table><thead><tr><th>Eesti</th><th>Hispaania</th></tr></thead><tbody>";
        vocabBody.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.es + "</td></tr>";
        });
        html += "</tbody></table>";
        html += "<div style='text-align:center; margin-top:12px;'>";
        html += "<button type='button' onclick='goBackFromVocab()'>Tagasi</button>";
        html += "</div>";
        html += "</div>";
      }

      listDiv.innerHTML = html;
    }

    vocabNumbersBtn.onclick = function () { showVocabCategory("numbers"); };
    vocabDaysBtn.onclick = function () { showVocabCategory("days"); };
    vocabBodyBtn.onclick = function () { showVocabCategory("body"); };
    vocabBackBtn.onclick = goBackFromVocab;

    // ---------- NUPUD TESTI JAOKS ----------

    const modeBodyBtn = document.getElementById("mode-body");
    const modeNumbersBtn = document.getElementById("mode-numbers");
    const modeDaysBtn = document.getElementById("mode-days");
    const nextBtn = document.getElementById("next-btn");
    const checkBtn = document.getElementById("check-btn");
    const restartBtn = document.getElementById("restart-btn");
    const cancelBtn = document.getElementById("cancel-btn");
    const answerInput = document.getElementById("answer-input");
    const voiceBtn = document.getElementById("voice-btn");
    const speechStatus = document.getElementById("speech-status");

    modeBodyBtn.onclick = function () { startMode("body"); };
    modeNumbersBtn.onclick = function () { startMode("numbers"); };
    modeDaysBtn.onclick = function () { startMode("days"); };
    nextBtn.onclick = function () { pickNewWord(); };
    checkBtn.onclick = function () { checkAnswer(); };
    restartBtn.onclick = function () { showSummary(); };
    cancelBtn.onclick = function () { showSummary(); };
    voiceBtn.onclick = function () { startVoiceInput(); };

    answerInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });

    // ---------- INIT ----------

    initSpeechRecognition();
    if (!speechSupported) {
      speechStatus.textContent = "H√§√§letuvastus ei ole selles brauseris toetatud.";
      if (voiceBtn) voiceBtn.disabled = true;
    } else {
      speechStatus.textContent = "Saad vajutada ‚Äû√útle vastus‚Äù ja r√§√§kida hispaania keeles.";
    }

    // algseis ‚Äì ainult √ºlemine valik (S√µnavara / Testi oskuseid)
    showInitial();

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch(function (e) { console.error(e); });
      });
    }
  </script>
</body>
</html>
